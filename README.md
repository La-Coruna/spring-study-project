# jpa 공부를 위한 프로젝트

## 📆 진행 기록 (Progress Timeline)
- 2025-07-06
  - 스프링 부트 프로젝트 생성 (start.spring.io 사용)
  - view, controller 테스트
  - h2 db 설치
- 2025-07-10
  - 엔티티 설계

## 📘 Key Learnings
- **JPA 개념**
  - JPA(Java Persistence API)는 객체와 관계형 데이터베이스 간의 패러다임 불일치를 해결하기 위한 ORM(Object-Relational Mapping) 표준 인터페이스이다.
  ![객체와 테이블의 연관관계 관점.png](docs/images/객체와 테이블의 연관관계 관점.png)
- 영속성(Persistence)
  - 영속성 컨텍스트(persistence context)는 '엔티티를 영구 저장하는 환경'이다.
  - 엔티티 매니저의 `persist()` 메소드를 사용하면, 엔티티를 영속성 컨텍스트에 저장하는 것이다.
  - 보통은 엔티티 매니저당 하나의 영속성 컨텍스트가 만들어지고, 상황에 따라서 여러 엔티티 매니저가 같은 영속성 컨텍스트에 접근할 수도 있다.
- 엔티티의 생명주기
  - 비영속: 영속성 컨텍스트와 전혀 관계가 없는 상태
  - 영속: 영속성 컨텍스트에 저장된 상태
  - 준영속: 영속성 컨텍스트에 저장되었다가 분리된 상태
  - 삭제: 삭제된 상태
- 엔티티 맵핑 어노테이션
  - @Entity
    - JPA를 사용해서 테이블과 매핑할 클래스 지정
      - name: JPA에서 사용할 엔티티 이름. 기본값은 클래스 이름
    - 기본 생성자 필수(파라미터가 없는 public 또는 protected 생성자)
    - final 클래스, enum, interface, inner 클래스에는 사용 불가
    - 저장할 필드에 final을 사용하면 안됨.
  - @Table
    - 엔티티와 매핑할 테이블을 지정.
      - name: 매핑할 테이블 이름. 기본값은 엔티티 이름
      - catalog: 데이터베이스의 catalog 매핑
      - schema: 데이터베이스의 schema 매핑
      - uniqueConstraints(DDL) : DDL 생성 시, 유니크 제약조건을 만듦.
  
## 💡 Useful Tips
- **엔티티 매니저**
  - 엔티티 매니저는 만드는 비용이 상당히 크다. -> 한 개만 만들어서 어플리케이션 전체에서 공유하도록 설계.
  - 엔티티 매니저 팩토리는 여러 스레드가 동시에 접근해도 안전하므로 서로 다른 스레드 간에 공유해도 되지만, 엔티티 매니저는 여러 스레드가 동시에 접근하면 동시성 문제가 발생하므로 스레드 간에 절대 공유하면 안된다.
  - 근데, 결국 스프링 부트가 엔티티 팩토리 생성과 엔티티 매니저 생성을 다 알아서 해주게 된다... 이 얼마나 편한 세상...
- **연관관계**
  - 외래 키가 있는 곳을 연관관계의 주인으로 정해라.
    - ex) 자동차와 바퀴에서는 바퀴를 연관관계의 주인으로.

